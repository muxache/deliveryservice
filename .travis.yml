dist: trusty
jdk: oraclejdk8
language: java
services:
- postgresql
- docker
env:
  global:
  - secure: mLb+goXqMSQevxk+uvwm2uuXZFDs0TopH3arypbK//00cild3euSfvSSxlTi7mrSipsn8zb8jjXtvEtpOfYHmBAcmJ2MUnmgm5GLlyrDUdjyuCqO1Jqf/JuDZUREiTJ8PLe4pZJNVu3QCTHme9IChQEQxXitd2VlIgTAMh/R4ZGhq7iF2gwO6FLsW/pWhAHucxnKtJaHKgBaFeVkKsZgadpATi7W9xUlH2Ip7PqqnLdLwR9Lt46serFGskem2e9NdKZq2ov6DDZTTLcLWOFVomdMvtKev0OIuWlGjhchU1qqdOR1DiAuKZwiqTfis2xtU2OosDxGaP6Ru3Iuz0/o+YVjGDwhbda9XoXeeCv1fzWps0eAvjA+UrmRoP2ISkdw3bdMXn8POIcMO4sYe3Ms8da6nP0F20NaWDxKBliwJdMmLW6AKE6fW3LRF7yTkNB1VJd9QigUwuGMO2Rdp5d2MDg9WhxHwFrnJkAWKBJuG2knjbqEm0DXCYia/XIYGVFXPrw/eUDaechX03mg9qHnjLf0k2Xgp5DCVJ5WKpTa0U8d3AbjgPKB7qej8wSw/rdYWd4zJmsrio//K5nvxmOfA5EaaOM07BRZhkpugczxwyPbSxTLnDUB7vunbX0bzLIrUEdIOnOjNvFXZuNszuon60iB3Jf1kDdbNDftMh5lUF8=
  - secure: qOaxKQYzbG77Pa0S3Mvnf4p+hpQMSoACs0sb+KsHdMHJoWBZTZ3DjiJ0WZnnNnhLX+zxETX7+dF0bMdPbf0XDGQL2Ga7RIiEs5hxT8sO6+6MisOmlz0aWbN4cz2OAdkS4nkY6rSu1Qd0anZOSyS3om6T2NANJBIPorYe6RC4e5QqUjA54l+BSuJPzcyTVIqxTvKzdYv4wrCNqS3FkcrzfUTOFeV9IbuDO15GMWC6ImxVhJHAntUl6iD77RRQUR/cskFAZ6F1iwVcXQ7KCTwp3naf6GEYKQtMfPJe1ljua6aw3XkwUeRRx/jzlE7XHtRN3R3ZNt6aWAquA/rnN9Li2aH2ZRs+TWzyxT1tJ0wZrguelDjy0Avk9SHL9uSyy7iA6RtSPA3pisGrcVHuHmeVsUa5qZ+SQS6uu9BK0l5SpsRZcgN3hRJvy2aF3fGUoNpuztCCgv503s4URiD2Q3TRJM+6Q/iZP0MoVhLlsRL8DTIshOWXCRktGHb0btr3THctWs+ZaZlaPtm6VuJ2ToLEOcJQwb8T1ir7HlghhtwX85GUN+aL2gcOQjiWFicT3DBxb2RwlN2jdrt+No3xT9EvvcWgx7fbLjhlZFdKcQNgIxOO0wXQR4qpHps16mIc9TtmKDGx7MEVj46tXz+C02QoYVIWAk/Enra8evYqanU46kM=
  - secure: bG1E9ZT2OH2yf2sXnyV5qGS7WmnKdoX6FB/47+G7c4Fm4+cZNvxHp+IRFIhMDgU8xBBw8Sz9u33pEPxD4Syngroa/p3u6VrqId/dyDvcfYVETylUue7bMAdAoFcIDsv/LY/MbC3gP/NTKuCQtUtl4XtnLwKbLt0+gLZUCDkynDJ6vLDEb+dyZGGFrVUF2xnBjDC4XjMUOpYZXDnElQj6IZZxkXntQiY7rSgN/Q7U1yHRZE7QSX0HUhXmnEmopmTd61Uy+K9dF3hAyjbi6N4bV8yq6L/tbxgQVDRGApYlQZo2bKrgLYviecEBULw66aOlv+1PV8ZmVC1WJE9dX+OTCCc3LbHvpOn81QzzSVWP2IPSjzI1i65Rnd8BO/4/3gD8kDGXdcfqqhQS03WVyUAu1avc/RecSaS0nxVqq5qncBWL5Y0lLt0nv1ImtoJ3iJ2kTp8nxwUBystKCeHWWcUN4p6JYH3wlHaDMKl7/2JSWo86+dh7ne+CgsxzMsRkkU0MKOrtWw8GEqeIc35PvRID/L5pEKFQt1W3IqO8wpe4Dp7OL3DpNcOXimBF4CCqB58ZwZJ7qCdCDhBHUvBXPgD5m3AoVqxJiTFv+IAevftVjmuhb2okhfsPtNHlPa7cJY+5a4frxRrqKkm26ZWaZKfX5tzC4XSw56D6zkis/lLZ5GY=
  - COMMIT=${TRAVIS_COMMIT::7}
script:
- "./mvnw clean install -B"
after_success:
- docker login -u $DOCKER_USER -p $DOCKER_PASS
- export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo "$TRAVIS_BRANCH";
  fi`
- export IMAGE_NAME=$DOCKER_USER/deliveryservice-docker-image
- docker build -t $IMAGE_NAME:latest .
- docker tag $IMAGE_NAME:latest $IMAGE_NAME:$TAG
- docker push $IMAGE_NAME:$TAG
deploy:
  provider: heroku
  api_key: "$HEROKU_API_KEY"
  app: deliveryservice1
